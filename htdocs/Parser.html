    <HTML> 
	<HEAD> 
	    <TITLE>HTML::Mason::Parser - Mason Component Parser

</TITLE> 
	</HEAD>

	<BODY>

<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#name">NAME</A>
	<LI><A HREF="#synopsis">SYNOPSIS</A>
	<LI><A HREF="#description">DESCRIPTION</A>
	<LI><A HREF="#parameters_for_new_constructor">PARAMETERS FOR new() CONSTRUCTOR	</A>
	<LI><A HREF="#accessor_methods">ACCESSOR METHODS</A>
	<LI><A HREF="#other_methods">OTHER METHODS</A>
	<LI><A HREF="#author">AUTHOR</A>
	<LI><A HREF="#see_also">SEE ALSO</A>
</UL>
<!-- INDEX END -->

<HR>
<P>
<H1><A NAME="name">NAME

</A></H1>
HTML::Mason::Parser - Mason Component Parser


<P>

<P>
<HR>
<H1><A NAME="synopsis">SYNOPSIS

</A></H1>
<PRE>    my $p = new HTML::Mason::Parser (...params...);
</PRE>

<P>

<P>
<HR>
<H1><A NAME="description">DESCRIPTION

</A></H1>
A Parser object translates components into Perl subroutines. Parsers are
typically embedded within (and used by) Interp objects.


<P>

<P>
<HR>
<H1><A NAME="parameters_for_new_constructor">PARAMETERS FOR new() CONSTRUCTOR	

</A></H1>
<DL>
<DT><STRONG><A NAME="item_allow_globals">allow_globals

</A></STRONG><DD>
List of variable names, complete with prefix (<CODE>$@%</CODE>), that you intend to use as globals in components. Normally global
variables are forbidden by <CODE>strict</CODE>, but any variable mentioned in this list is granted a reprieve via a ``use
vars'' statement. For example:


<P>

<PRE>    allow_globals =&gt; [qw($DBH %session)]
</PRE>

<P>

In a mod_perl environment, <CODE>$r</CODE> (the request object) is automatically added to this list.


<P>

<DT><STRONG><A NAME="item_ignore_warnings_expr">ignore_warnings_expr

</A></STRONG><DD>
Regular expression indicating which warnings to ignore when compiling
subroutines. Any warning that is not ignored will prevent the component
from being compiled and executed. For example:


<P>

<PRE>    ignore_warnings_expr =&gt;
        'Global symbol.*requires explicit package'
</PRE>

<P>

Undefined by default, meaning that all warnings are fatal. 


<P>

<DT><STRONG><A NAME="item_in_package">in_package

</A></STRONG><DD>
Indicates the name of the package you wish your components to run in. This
way different applications or virtual hosts can be run in different name
spaces. Default is <CODE>HTML::Mason::Commands</CODE>.


<P>

You will have to explicitly import the mc_* commands from <CODE>HTML::Mason::Commands</CODE>
into your package. Ideally you will put this in your <CODE>handler.pl</CODE>:


<P>

<PRE>    { package MyPackage;
    use HTML::Mason::Commands; }
</PRE>

<P>

This will bring in all of the mc_ commands. If you want to save some space
on imported symbols, specify just the commands you want:


<P>

<PRE>    { package MyPackage;
    use HTML::Mason::Commands qw(mc_comp mc_file mc_cache); }
</PRE>

<P>

<DT><STRONG><A NAME="item_postamble">postamble

</A></STRONG><DD>
A piece of Perl code to insert at the end of every compiled subroutine.
Blank by default. See <A HREF="./Parser.html#item_preamble">preamble</A>.


<P>

<DT><STRONG><A NAME="item_postprocess">postprocess

</A></STRONG><DD>
Sub reference that is called to postprocess the code and text portions of a
compiled component, just before it is assembled into its final subroutine
form. The sub is called with two parameters, a scalar reference to the
script and a string containing either ``perl'' or ``alpha'' depending on
whether the string is code or text respectively. The sub is expected to
process the string in-place. It will be called multiple times, once for
each piece of code and text.


<P>

This is the ideal place to translate accents into HTML entities. It could
also be used to strip out comments that you have in your HTML files that
you don't want the end user to see. See <A HREF="./Parser.html#item_preprocess">preprocess</A>.


<P>

<DT><STRONG><A NAME="item_preamble">preamble

</A></STRONG><DD>
A piece of Perl code to insert at the beginning of every compiled
subroutine. Blank by default, but ApacheHandler adds the line


<P>

<PRE>    use vars qw($r);
</PRE>

<P>

to suppress strict warnings about uses of global <CODE>$r</CODE> (the
Apache request object). See <A HREF="./Parser.html#item_postamble">postamble</A>.


<P>

<DT><STRONG><A NAME="item_preprocess">preprocess

</A></STRONG><DD>
Sub reference that is called to preprocess each component before Parser
does it's magic. The sub is called with a single parameter, a scalar
reference to the script. The sub is expected to process the script
in-place. This is one way to extend the HTML::Mason syntax with new tags,
etc. See <A HREF="./Parser.html#item_postprocess">postprocess</A>.


<P>

<DT><STRONG><A NAME="item_source_refer_predicate">source_refer_predicate

</A></STRONG><DD>
Reference to a subroutine that decides whether a given component should be
compiled with <A HREF="././Admin.html#source_references">source references</A>. The subroutine takes two arguments: first, the total number of characters
in the component source; second, the number of characters devoted to plain
text. For example, this component:


<P>

<PRE>        % my $noun = &quot;World&quot;;
        Hello, &lt;% $noun %&gt;!
        How are ya?
</PRE>

<P>

Has 51 total bytes, 19 of which are plain text. This allows you to adjust
the trade-off between the memory savings of source references and the
performance advantage of in-line plain text. For example, to choose only
components with at least 50% plain text:


<P>

<PRE>    source_refer_predicate =&gt;
        sub { return $_[1] / $_[0] &gt;= 0.5 }
</PRE>

<P>

The current default is


<P>

<PRE>    sub { return $_[1] &gt;= 500 }
</PRE>

<P>

i.e. any component with at least 500 characters. This is an experimental
setting and may change.


<P>

<DT><STRONG><A NAME="item_taint_check">taint_check

</A></STRONG><DD>
This flag allows Mason to work when taint checking is on (e.g.
PerlTaintCheck or <CODE>-T</CODE> flag). If true, Mason will pass all component source and filenames through
a dummy regular expression match to untaint them. In the future this option
may become more sophisticated to allow stricter checks. Default is false.


<P>

<DT><STRONG><A NAME="item_use_strict">use_strict

</A></STRONG><DD>
Indicates whether to use strict in compiled subroutines. Default is true.


<P>

</DL>
<P>
<HR>
<H1><A NAME="accessor_methods">ACCESSOR METHODS

</A></H1>
Most of the above properties have standard accessor methods of the same
name: no arguments retrieves the value, and one argument sets it. For
example:


<P>

<PRE>    my $parser = new HTML::Mason::Parser;
    my $strictmode = $parser-&gt;use_strict;
    $parser-&gt;use_strict(1);
</PRE>

<P>

The only exception is <A HREF="./Parser.html#item_allow_globals">allow_globals</A>, which works a bit differently.


<P>

<P>
<HR>
<H1><A NAME="other_methods">OTHER METHODS

</A></H1>
<DL>
<DT><STRONG><A NAME="item_allow_globals_varnames_">allow_globals (varnames)

</A></STRONG><DD>
Called with no arguments, this returns the value of allow_globals as a
list. Called with one or more variable names, it appends the names to the
existing list, removing duplicates if any.


<P>

<a name="item_parse">

<DT><STRONG><A NAME="item_parse_script_script_file_">parse ([$script, $script_file, \$result_code, \$result_text,
\$pure_text_flag, \$error, $wrap_errors, $save_to])

</A></STRONG><DD>
This method performs the main function of Parser: it compiles a component
into a Perl subroutine.


<P>

The component may be passed in as a string in <EM>script</EM>, or as a filename in <EM>script_file</EM>.


<P>

The subroutine can be output in three ways. <EM>result_text</EM> is an optional scalar reference; if specified, it is filled with a Perl
script that, when evaluated, returns the new subroutine. <EM>result_code</EM> is an optional code reference filled with the new subroutine itself.  <EM>save_to</EM> is an optional filename for an object file.


<P>

The method returns 1 on success and 0 if there was an error.  <EM>error</EM>
is an optional scalar reference filled with any parsing or compilation
errors that occur. Alternatively, if the <EM>wrap_errors</EM> flag is set to true, then any errors that occur are simply wrapped up to be
displayed by the subroutine -- in this case the method always ``succeeds''
and returns 1.


<P>

<EM>pure_text_flag</EM> is an optional scalar reference filled with a flag indicating whether the
component was pure text (free of Mason syntax).


<P>

Here's an example that creates an object file from a component source file:


<P>

<PRE>    $parser-&gt;parse(script_file =&gt; '/usr/www/docs/template',
                    save_to =&gt; '/usr/www/data/obj/template',
                    error =&gt; \$error)
         or die &quot;error while compiling component: $error&quot;;
</PRE>

<P>

</DL>
<P>
<HR>
<H1><A NAME="author">AUTHOR

</A></H1>
Jonathan Swartz, <A
HREF="MAILTO:swartz@transbay.net">swartz@transbay.net</A>


<P>

<P>
<HR>
<H1><A NAME="see_also">SEE ALSO

</A></H1>
<A HREF="././Mason.html#">HTML::Mason</A>,
<A HREF="././Interp.html#">HTML::Mason::Interp</A>,
<A HREF="././ApacheHandler.html#">HTML::Mason::ApacheHandler</A>,
<A HREF="././Admin.html#">HTML::Mason::Admin</A>




<P>

</DL>
    </BODY>

    </HTML>
